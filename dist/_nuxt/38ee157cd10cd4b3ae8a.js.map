{"version":3,"sources":["webpack:///./node_modules/@rancher/shell/utils/install-redirect.js","webpack:///./node_modules/@rancher/shell/pages/c/_cluster/monitoring/index.vue?6fde","webpack:///node_modules/@rancher/shell/pages/c/_cluster/monitoring/index.vue","webpack:///./node_modules/@rancher/shell/pages/c/_cluster/monitoring/index.vue?ef20","webpack:///./node_modules/@rancher/shell/pages/c/_cluster/monitoring/index.vue"],"names":["product","chartName","defaultResourceOrRoute","install","redirect","store","cluster","getters","id","name","params","resource","dispatch","chart","query","REPO_TYPE","repoType","REPO","repoName","CHART","VERSION","versions","version","components","Banner","LazyImage","SimpleBox","AlertTable","middleware","fetch","data","availableLinks","alertmanager","grafana","prometheus","resources","v1Installed","externalLinks","enabled","group","iconSrc","label","description","link","methods","fetchDeps","$store","haveV1MonitoringWorkloads","allHash","endpoints","type","hash","amMatch","grafanaMatch","promeMatch","CATTLE_MONITORING_NAMESPACE","match","component","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","scopedSlots","_u","key","fn","proxy","_e","_l","fel","directives","rawName","value","undefined","t","expression","class","disabled","_m"],"mappings":"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","file":"38ee157cd10cd4b3ae8a.js","sourcesContent":["import { REPO_TYPE, REPO, CHART, VERSION } from '@shell/config/query-params';\n\nexport default function(product, chartName, defaultResourceOrRoute, install = true) {\n  return async function middleware({ redirect, store } ) {\n    const cluster = store.getters['currentCluster']?.id || 'local';\n\n    if ( store.getters['type-map/isProductActive'](product) ) {\n      // If the product is installed and there's a default resource, redirect there\n\n      if ( defaultResourceOrRoute ) {\n        if ( typeof defaultResourceOrRoute === 'object' ) {\n          return redirect(defaultResourceOrRoute);\n        }\n\n        return redirect({\n          name:   'c-cluster-product-resource',\n          params: {\n            cluster,\n            product,\n            resource: defaultResourceOrRoute\n          },\n        });\n      }\n\n      // Otherwise just let the middleware pass through\n    } else if (install) {\n      // The product is not installed, redirect to the details chart\n\n      await store.dispatch('catalog/load');\n\n      const chart = store.getters['catalog/chart']({ chartName });\n\n      if ( chart ) {\n        return redirect({\n          name:   'c-cluster-apps-charts-chart',\n          params: { cluster },\n          query:  {\n            [REPO_TYPE]: chart.repoType,\n            [REPO]:      chart.repoName,\n            [CHART]:     chart.chartName,\n            [VERSION]:   chart.versions[0].version\n          },\n        });\n      } else {\n        // The chart's not available\n        store.dispatch('loadingError', `Chart not found for ${ product }`);\n      }\n    } else {\n      return redirect({\n        name:   'c-cluster-explorer',\n        params: { cluster },\n      });\n    }\n  };\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('header',{staticClass:\"row\"},[_c('div',{staticClass:\"col span-12\"},[_c('h1',[_c('t',{attrs:{\"k\":\"monitoring.overview.title\"}})],1),_vm._v(\" \"),_c('div',[_c('t',{attrs:{\"k\":\"monitoring.overview.subtitle\",\"raw\":true}})],1)])]),_vm._v(\" \"),_c('div',[(_vm.v1Installed)?_c('Banner',{attrs:{\"color\":\"warning\"},scopedSlots:_vm._u([{key:\"default\",fn:function(){return [_c('t',{attrs:{\"k\":\"monitoring.v1Warning\",\"raw\":true}})]},proxy:true}],null,false,1527155515)}):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"create-resource-container\"},[_c('div',{staticClass:\"subtypes-container\"},_vm._l((_vm.externalLinks),function(fel){return _c('a',{directives:[{name:\"tooltip\",rawName:\"v-tooltip\",value:(\n            !fel.enabled ? _vm.t('monitoring.overview.linkedList.na') : undefined\n          ),expression:\"\\n            !fel.enabled ? t('monitoring.overview.linkedList.na') : undefined\\n          \"}],key:fel.label,class:{ 'subtype-banner': true, disabled: !fel.enabled },attrs:{\"href\":fel.enabled ? fel.link : void 0,\"disabled\":!fel.enabled,\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_c('div',{staticClass:\"subtype-content\"},[_c('div',{staticClass:\"title\"},[_c('div',{staticClass:\"subtype-logo round-image\"},[_c('LazyImage',{attrs:{\"src\":fel.iconSrc}})],1),_vm._v(\" \"),_c('h5',[_c('span',[_c('t',{attrs:{\"k\":fel.label}})],1)]),_vm._v(\" \"),_vm._m(0,true)]),_vm._v(\" \"),_c('hr'),_vm._v(\" \"),_c('div',{staticClass:\"description\"},[_c('span',[_c('t',{attrs:{\"k\":fel.description}})],1)])])])}),0)])],1),_vm._v(\" \"),_c('div',[_c('SimpleBox',{staticClass:\"mt-30\",attrs:{\"title\":_vm.t('monitoring.overview.alertsList.label')}},[_c('AlertTable')],1)],1)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"flex-right\"},[_c('i',{staticClass:\"icon icon-external-link\"})])}]\n\nexport { render, staticRenderFns }","<script>\nimport isEmpty from 'lodash/isEmpty';\n\nimport InstallRedirect from '@shell/utils/install-redirect';\nimport AlertTable from '@shell/components/AlertTable';\nimport { NAME, CHART_NAME } from '@shell/config/product/monitoring';\nimport { ENDPOINTS, MONITORING } from '@shell/config/types';\nimport { allHash } from '@shell/utils/promise';\nimport { findBy } from '@shell/utils/array';\n\nimport { Banner } from '@components/Banner';\nimport LazyImage from '@shell/components/LazyImage';\nimport SimpleBox from '@shell/components/SimpleBox';\nimport { haveV1MonitoringWorkloads } from '@shell/utils/monitoring';\n\nconst CATTLE_MONITORING_NAMESPACE = 'cattle-monitoring-system';\n\nexport default {\n  components: {\n    Banner,\n    LazyImage,\n    SimpleBox,\n    AlertTable\n  },\n\n  middleware: InstallRedirect(NAME, CHART_NAME),\n\n  async fetch() {\n    await this.fetchDeps();\n  },\n\n  data() {\n    const grafanaSrc = require('~shell/assets/images/vendor/grafana.svg');\n    const prometheusSrc = require('~shell/assets/images/vendor/prometheus.svg');\n    const currentCluster = this.$store.getters['currentCluster'];\n\n    return {\n      availableLinks: {\n        alertmanager: false,\n        grafana:      false,\n        prometheus:   false,\n      },\n      resources:     [MONITORING.ALERTMANAGER, MONITORING.PROMETHEUS],\n      v1Installed:   false,\n      externalLinks: [\n        {\n          enabled:     false,\n          group:       'alertmanager',\n          iconSrc:     prometheusSrc,\n          label:       'monitoring.overview.linkedList.alertManager.label',\n          description:\n            'monitoring.overview.linkedList.alertManager.description',\n          link: `/k8s/clusters/${ currentCluster.id }/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-alertmanager:9093/proxy`,\n        },\n        {\n          enabled:     false,\n          group:       'grafana',\n          iconSrc:     grafanaSrc,\n          label:       'monitoring.overview.linkedList.grafana.label',\n          description: 'monitoring.overview.linkedList.grafana.description',\n          link:        `/k8s/clusters/${ currentCluster.id }/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-grafana:80/proxy`,\n        },\n        {\n          enabled:     false,\n          group:       'prometheus',\n          iconSrc:     prometheusSrc,\n          label:       'monitoring.overview.linkedList.prometheusPromQl.label',\n          description:\n            'monitoring.overview.linkedList.prometheusPromQl.description',\n          link: `/k8s/clusters/${ currentCluster.id }/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-prometheus:9090/proxy/graph`,\n        },\n        {\n          enabled:     false,\n          group:       'prometheus',\n          iconSrc:     prometheusSrc,\n          label:       'monitoring.overview.linkedList.prometheusRules.label',\n          description:\n            'monitoring.overview.linkedList.prometheusRules.description',\n          link: `/k8s/clusters/${ currentCluster.id }/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-prometheus:9090/proxy/rules`,\n        },\n        {\n          enabled:     false,\n          group:       'prometheus',\n          iconSrc:     prometheusSrc,\n          label:       'monitoring.overview.linkedList.prometheusTargets.label',\n          description:\n            'monitoring.overview.linkedList.prometheusTargets.description',\n          link: `/k8s/clusters/${ currentCluster.id }/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-prometheus:9090/proxy/targets`,\n        },\n      ]\n    };\n  },\n\n  methods: {\n    async fetchDeps() {\n      const { $store, externalLinks } = this;\n\n      this.v1Installed = await haveV1MonitoringWorkloads($store);\n\n      const hash = await allHash({ endpoints: $store.dispatch('cluster/findAll', { type: ENDPOINTS }) });\n\n      if (!isEmpty(hash.endpoints)) {\n        const amMatch = findBy(externalLinks, 'group', 'alertmanager');\n        const grafanaMatch = findBy(externalLinks, 'group', 'grafana');\n        const promeMatch = externalLinks.filter(\n          el => el.group === 'prometheus'\n        );\n        const alertmanager = findBy(\n          hash.endpoints,\n          'id',\n          `${ CATTLE_MONITORING_NAMESPACE }/rancher-monitoring-alertmanager`\n        );\n        const grafana = findBy(\n          hash.endpoints,\n          'id',\n          `${ CATTLE_MONITORING_NAMESPACE }/rancher-monitoring-grafana`\n        );\n        const prometheus = findBy(\n          hash.endpoints,\n          'id',\n          `${ CATTLE_MONITORING_NAMESPACE }/rancher-monitoring-prometheus`\n        );\n\n        if (!isEmpty(alertmanager) && !isEmpty(alertmanager.subsets)) {\n          amMatch.enabled = true;\n        }\n        if (!isEmpty(grafana) && !isEmpty(grafana.subsets)) {\n          grafanaMatch.enabled = true;\n        }\n        if (!isEmpty(prometheus) && !isEmpty(prometheus.subsets)) {\n          promeMatch.forEach((match) => {\n            match.enabled = true;\n          });\n        }\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <section>\n    <header class=\"row\">\n      <div class=\"col span-12\">\n        <h1>\n          <t k=\"monitoring.overview.title\" />\n        </h1>\n        <div>\n          <t k=\"monitoring.overview.subtitle\" :raw=\"true\" />\n        </div>\n      </div>\n    </header>\n    <div>\n      <Banner v-if=\"v1Installed\" color=\"warning\">\n        <template #default>\n          <t k=\"monitoring.v1Warning\" :raw=\"true\" />\n        </template>\n      </Banner>\n      <div class=\"create-resource-container\">\n        <div class=\"subtypes-container\">\n          <a\n            v-for=\"fel in externalLinks\"\n            :key=\"fel.label\"\n            v-tooltip=\"\n              !fel.enabled ? t('monitoring.overview.linkedList.na') : undefined\n            \"\n            :href=\"fel.enabled ? fel.link : void 0\"\n            :disabled=\"!fel.enabled\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            :class=\"{ 'subtype-banner': true, disabled: !fel.enabled }\"\n          >\n            <div class=\"subtype-content\">\n              <div class=\"title\">\n                <div class=\"subtype-logo round-image\">\n                  <LazyImage :src=\"fel.iconSrc\" />\n                </div>\n                <h5>\n                  <span>\n                    <t :k=\"fel.label\" />\n                  </span>\n                </h5>\n                <div class=\"flex-right\">\n                  <i class=\"icon icon-external-link\" />\n                </div>\n              </div>\n              <hr />\n              <div class=\"description\">\n                <span>\n                  <t :k=\"fel.description\" />\n                </span>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n    </div>\n    <div>\n      <SimpleBox\n        class=\"mt-30\"\n        :title=\"t('monitoring.overview.alertsList.label')\"\n      >\n        <AlertTable />\n      </SimpleBox>\n    </div>\n  </section>\n</template>\n","import mod from \"-!../../../../../../cache-loader/dist/cjs.js??ref--6-0!../../../../../../thread-loader/dist/cjs.js??ref--6-1!../../../../../../babel-loader/lib/index.js??ref--6-2!../../../../../../vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../cache-loader/dist/cjs.js??ref--6-0!../../../../../../thread-loader/dist/cjs.js??ref--6-1!../../../../../../babel-loader/lib/index.js??ref--6-2!../../../../../../vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=7d103f36&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}